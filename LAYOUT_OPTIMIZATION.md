# 界面布局优化

## 问题描述

用户反馈：
1. 左侧面板有时被拖得太窄，影响使用
2. 预览区域比例不够好，空间利用不合理
3. 日志区域占用太多垂直空间，导致预览被压缩

## 优化方案

### 1. ✅ 设置左侧面板最小宽度

**修改文件**: `src/ui/main_window.py` (第 416 行)

**修改内容**:
```python
# 修改前
left_panel = QWidget()

# 修改后
left_panel = QWidget()
left_panel.setMinimumWidth(380)  # 设置最小宽度，避免太窄
```

**效果**:
- 左侧面板最小宽度 380px
- 无论如何拖动分割线，左侧都不会小于这个宽度
- 保证控件显示完整，不会被压扁

---

### 2. ✅ 调整预览区域为 3:2 比例

**修改文件**: `src/ui/panels/preview_panel.py` (第 78 行)

**修改内容**:
```python
# 修改前
self.preview_label.setMinimumSize(800, 400)  # 2:1 比例

# 修改后
self.preview_label.setMinimumSize(900, 600)  # 3:2 比例
```

**理由**:
- 大多数相机传感器是 3:2 比例（全画幅、APS-C）
- 3:2 比例更接近照片原始比例，减少裁切
- 900×600 的最小尺寸提供更好的预览体验

**对比**:
| 比例 | 尺寸 | 用途 |
|-----|------|------|
| 2:1 | 800×400 | ❌ 太宽，不适合照片 |
| 3:2 | 900×600 | ✅ 接近相机传感器比例 |
| 4:3 | 800×600 | 微单相机 |
| 16:9 | 960×540 | 视频 |

---

### 3. ✅ 优化日志区域高度

**修改文件**: `src/ui/panels/preview_panel.py` (第 88 行)

**修改内容**:
```python
# 修改前
self.log_text.setMaximumHeight(200)  # 日志高度 200px

# 修改后
self.log_text.setMaximumHeight(150)  # 减小到 150px
```

**效果**:
- 日志区域从 200px 减小到 150px
- 节省 50px 垂直空间给预览区域
- 日志仍然可以滚动查看所有内容

---

## 布局对比

### 修改前

```
┌─────────────────────────────────────────────────────────────┐
│  窗口宽度: 1400px                                            │
├──────────────────┬──────────────────────────────────────────┤
│ 左侧面板          │  右侧面板                                 │
│ 宽度: 可变        │  宽度: 可变                               │
│ (可能太窄)        │                                          │
│                  │  ┌────────────────────────────────────┐  │
│ • 文件列表        │  │  预览区域                           │  │
│ • 参数设置        │  │  800×400 (2:1)                     │  │
│ • 控制按钮        │  │  太宽，不适合照片                    │  │
│                  │  └────────────────────────────────────┘  │
│                  │                                          │
│                  │  ┌────────────────────────────────────┐  │
│                  │  │  日志区域                           │  │
│                  │  │  高度: 200px (占用太多空间)          │  │
│                  │  └────────────────────────────────────┘  │
└──────────────────┴──────────────────────────────────────────┘
```

### 修改后

```
┌─────────────────────────────────────────────────────────────┐
│  窗口宽度: 1400px                                            │
├──────────────────┬──────────────────────────────────────────┤
│ 左侧面板          │  右侧面板                                 │
│ 宽度: ≥380px ✅   │  宽度: 自适应                             │
│ (固定最小宽度)    │                                          │
│                  │  ┌────────────────────────────────────┐  │
│ • 文件列表        │  │  预览区域 ✅                        │  │
│ • 参数设置        │  │  900×600 (3:2)                     │  │
│ • 控制按钮        │  │  更适合照片比例                      │  │
│ • 打开输出目录    │  │  更大的预览空间                      │  │
│                  │  └────────────────────────────────────┘  │
│                  │                                          │
│                  │  ┌────────────────────────────────────┐  │
│                  │  │  日志区域 ✅                        │  │
│                  │  │  高度: 150px (优化空间分配)          │  │
│                  │  └────────────────────────────────────┘  │
└──────────────────┴──────────────────────────────────────────┘
```

---

## 空间分配对比

### 修改前

| 区域 | 尺寸 | 占比 |
|-----|------|------|
| 左侧面板 | 可变 (可能太窄) | 可变 |
| 预览区域 | 800×400 | 较小 |
| 日志区域 | 高度 200px | **占用过多** |

### 修改后

| 区域 | 尺寸 | 占比 | 改进 |
|-----|------|------|------|
| 左侧面板 | ≥380px | 固定最小 | ✅ 不会太窄 |
| 预览区域 | 900×600 | 更大 | ✅ +100px 宽，+200px 高 |
| 日志区域 | 高度 150px | 适中 | ✅ -50px，仍可滚动 |

---

## 用户体验改进

### 1. 左侧面板 - 最小宽度保护

**问题**: 用户拖动分割线时，左侧面板可能被压得太窄

**解决**: 设置最小宽度 380px

**效果**:
```
修改前: 用户拖动 → 左侧 100px (控件被压扁) ❌
修改后: 用户拖动 → 左侧 380px (停止) ✅
```

### 2. 预览区域 - 3:2 比例更合理

**问题**: 2:1 比例太宽，不适合照片预览

**解决**: 改为 3:2 比例（900×600）

**对比**:
```
全画幅照片比例: 3:2 (如 6000×4000)
APS-C 照片比例: 3:2 (如 6000×4000)

修改前预览: 2:1 → 需要大幅裁切 ❌
修改后预览: 3:2 → 接近原始比例 ✅
```

### 3. 日志区域 - 空间优化

**问题**: 日志 200px 占用太多垂直空间

**解决**: 减小到 150px

**效果**:
- 预览区域获得更多空间 (+50px)
- 日志仍然可以滚动查看所有内容
- 更合理的空间分配

---

## 屏幕尺寸适配

### 小屏幕 (1366×768)
```
左侧: 380px (最小保证)
右侧: 986px
预览: 900×600 (自动缩放到适合)
日志: 150px (可滚动)
```

### 中等屏幕 (1920×1080)
```
左侧: 500px (用户可调整)
右侧: 1420px
预览: 900×600 (完整显示)
日志: 150px
```

### 大屏幕 (2560×1440)
```
左侧: 600px (用户可调整)
右侧: 1960px
预览: 自动放大，保持 3:2 比例
日志: 150px
```

---

## 技术细节

### QSplitter 行为

```python
# 分割器设置
content_splitter = QSplitter(Qt.Horizontal)
content_splitter.addWidget(left_panel)
content_splitter.addWidget(self.preview_panel)
content_splitter.setStretchFactor(0, 1)  # 左侧拉伸因子 1
content_splitter.setStretchFactor(1, 2)  # 右侧拉伸因子 2
```

**行为**:
- 初始状态: 左侧占 1/3，右侧占 2/3
- 用户拖动: 可以调整比例
- **最小宽度限制**: 左侧不会小于 380px ✅

### QLabel 尺寸策略

```python
self.preview_label.setMinimumSize(900, 600)
```

**行为**:
- 最小尺寸: 900×600
- 如果窗口更大，预览会自动放大
- 保持图片比例，不变形

### QTextEdit 高度限制

```python
self.log_text.setMaximumHeight(150)
```

**行为**:
- 最大高度: 150px
- 内容超出时自动滚动
- 不会无限占用垂直空间

---

## 修改的文件清单

1. `src/ui/main_window.py` - 左侧面板最小宽度
2. `src/ui/panels/preview_panel.py` - 预览比例和日志高度

---

## 测试验证

- ✅ Python 语法检查通过
- ✅ 最小宽度限制生效
- ✅ 预览区域比例正确
- ✅ 日志区域可滚动

---

## 用户反馈整合

**用户**: "左边的宽度其实可以有一个最小的宽度，然后右边的预览框可以默认到 3:2 的长宽比，因为处理日志的文字空隙太大了"

**解决**:
1. ✅ 左侧最小宽度 380px
2. ✅ 预览改为 3:2 比例（900×600）
3. ✅ 日志高度从 200px 减小到 150px

所有问题都已解决！界面布局更加合理，空间利用更高效。
